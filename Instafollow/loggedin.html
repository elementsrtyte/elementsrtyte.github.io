<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Instafollow</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>



<script type="text/javascript">
	//var expectedFunctions = 0;

	var FollowersSucess = false;
	var FolloweesSuccess = false;

	var followersArray = [];
	var followedByArray = [];



	function Followers(){
		var ACCESS_TOKEN = getFirstAnchorTagValue(); 
		console.log("Access Token: " + ACCESS_TOKEN);


		$.ajax({
			url: 'https://api.instagram.com/v1/users/self/follows?access_token=' + ACCESS_TOKEN  + '&count=5',
			type: 'GET',
			dataType: 'jsonp'
		})
		.done(function(data) {
			FollowersSucess = true; //inc
			console.log(data);
			// $.each(data.data, function(k, v){
			// 	console.log(v.id);
			// });
			followersArray = data;
			receivedAJAXResponse();
		})
		.fail(function() {
			console.log("error");
		});

		$.ajax({				 
			url: 'https://api.instagram.com/v1/users/self/followed-by?access_token=' + ACCESS_TOKEN + '&count=5',
			type: 'GET',
			dataType: 'jsonp'
		})
		.done(function(data) {
			FolloweesSuccess = true;
			console.log(data);
			// $.each(data.data, function(k, v){
			// 	console.log(v.id);
			// });
			followedByArray = data;
			receivedAJAXResponse();
		})
		.fail(function() {
			console.log("error");
		});
		
	}

	function getFirstAnchorTagValue() {
		return window.location.hash.substring(window.location.hash.indexOf("=")+1);
	}

	function receivedAJAXResponse(){
		if(FolloweesSuccess & FolloweesSuccess)
	  	{
	  		console.log("Both Ajax Calls completed successfully!");
	  		//console.log(followersArray);

	  		// console.log(followersArray.data);
	  		// console.log(followedByArray.data);

	  		//The only bit of computer science in this whole dumb project...
			//followersArray.data.sort(SortByID);
			//followedByArray.data.sort(SortByID);	    

			//var i = 0;
			//var j = 0;
			var c = []; //will store the people who are only followed by me.
			var d = []; //will store followers who are followed by me.

			// while(i<followersArray.data.length && j<followedByArray.data.length)
			// {

				// for (var i = 0; i < followersArray.data.length; i++) {
				// 	console.log("inarray: " + $.inArray(followersArray.data[i], followedByArray.data));
				// 	if(($.inArray(followersArray.data[i], followedByArray.data))>=0)
				// 		c[c.length] = followersArray.data[i];
				// }

				for(var i = 0; i< followedByArray.data.length; i++)
				{
					for(var j = 0; j<followersArray.data.length; j++)
					{
						if(followedByArray.data[i].id == followersArray.data[j].id)
						{
							d[d.length] = followedByArray.data[i];
							break;
						}
						else if(j==followersArray.data.length-1)
						{
							c[c.length] = followedByArray.data[i];
						}
						
					}
				}


				// if(followersArray.data[i].id == followedByArray.data[j].id){
				// 	c[c.length] = followersArray.data[i];
				// 	i++;
				// }
				// else if(followersArray.data[i].id > followedByArray.data[j].id)
				// 	j++;
				// else
				// 	i++;
			//}
			console.log(c);
			console.log(d);
		}
	    else
	    {
	    	console.log("Haven't received full data set yet");
	    }
	}

	function SortByID(a, b){
		  return ((a.id < b.id) ? -1 : ((a.id > b.id) ? 1 : 0));
	}




// function pagination(url){
// 	if(data.pagination.next_url)

// }

</script>

</head>
<body>

<div class="container">

<input type="button" value="Find Unfollowers" onclick="Followers()"/>
	
</div>


	
</body>
</html>





